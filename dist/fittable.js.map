{"version":3,"sources":["src/js/app.js"],"names":[],"mappings":";;;;;;;AAOE;;AAEE;AACA;;;AAGF;AACE;AACA;AACA;;;AAGF;AACE;AACA;;AAEA;AACE;;;AAGF;;;AAGF;AACE;;;AAGF;AACE;AACA;;AAEA;AACE;AACA;;AAEA;AACA;;;AAGF;;;AAGF;AACE;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;;AAGF;AACE;;;;;;;AAOA;;;AAGF;;;;AAIA;AACE;;AAEE;;;AAGA;AACE;;AAEF;AACA;;;;;;;;;;;;;AAaA;AACE;AACA;;;AAGF;;;;;;;;AAQJ;AACE;;AAEA;;;;;;AAMF;AACE;AACA;AACE;;AAEF;;AAEF;AACE;AACA;AACE;;AAEF;;;;;;;AAOF;AACE;;;;;AAKF;AACA;;AAEA;AACE;AACA;AACA;AACA;;;;;;;AAOF;AACE;AACE;;;CAIL,CAAC,CAAC","file":"src/js/app.js","sourcesContent":["\"use strict\";\n\n$(document).ready(function () {\n\n\n\n  /** Funkce pro zavření paralelek */\n  var closeParallels = function () {\n    /*$(\".parallel\").removeClass(\"parallel-extended\").each(function(num,el) { $(el)[0].style = \" \"; });*/\n    $(\".parallel-details\").slideUp(400);\n    $(\"section#timetable\").removeClass(\"fade-inactive\");\n  };\n\n  var switchWeek = function (week) {\n    $(\"section#timetable\").attr(\"data-week\", week);\n    $(\"#heading .primary-head strong\").text(\"Týden \" + week);\n    $(\"#heading .primary-head span\").text(week % 2 == 0 ? \"Sudý\" : \"Lichý\");\n  };\n\n  var showEvents = function (events) {\n    var timeExtremes = findMinMaxTimes(events);\n    $(\"#timetable\").attr(\"data-mintime\", timeExtremes[0]).attr(\"data-maxtime\", timeExtremes[1]);\n\n    $.each(events, function (num, el) {\n      createEventElement(el);\n    });\n\n    console.log(events);\n  };\n\n  var getSecondsToday = function (momentDate) {\n    return momentDate.hours() * 3600 + momentDate.minutes() * 60 + momentDate.seconds();\n  };\n\n  var findMinMaxTimes = function (siriusEvents) {\n    var min = getSecondsToday(moment(siriusEvents[0].starts_at));\n    var max = getSecondsToday(moment(siriusEvents[0].ends_at));\n\n    $.each(siriusEvents, function (num, el) {\n      var estart = getSecondsToday(moment(el.starts_at));\n      var eend = getSecondsToday(moment(el.ends_at));\n\n      if (estart < min) min = estart;\n      if (eend > max) max = eend;\n    });\n\n    return [min, max];\n  };\n\n  var createEventElement = function (siriusEventobj) {\n    var element = $(\"<div>\").addClass(\"parallel\").attr(\"role\", \"listitem\").attr(\"data-from\", siriusEventobj.starts_at).attr(\"data-to\", siriusEventobj.ends_at);\n\n    element.append($(\"<div>\").addClass(\"inner-item\"));\n\n    element.children().append($(\"<h1>\").text(siriusEventobj.links.course));\n    element.children().append($(\"<div>\").addClass(\"place\").text(siriusEventobj.links.room));\n    element.children().append($(\"<div>\").addClass(\"time\").text(moment(siriusEventobj.starts_at).format(\"h:mm\") + \"-\" + moment(siriusEventobj.ends_at).format(\"h:mm\")));\n\n    $(\"#timetable .row.day\").eq(parseInt(moment(siriusEventobj.starts_at).format(\"d\")) - 1).find(\".day-parallels\").append(element);\n\n    setEventRightSize($(\"#timetable\"), element);\n  };\n\n  var setEventRightSize = function (timetableDOMobj, eventDOMobj) {\n    var tablestarts = $(timetableDOMobj).attr(\"data-mintime\"),\n        fulldiff = $(timetableDOMobj).attr(\"data-maxtime\") - $(timetableDOMobj).attr(\"data-mintime\"),\n        eventstarts = moment($(eventDOMobj).attr(\"data-from\")),\n        eventends = moment($(eventDOMobj).attr(\"data-to\")),\n        eventlength = eventends.diff(eventstarts, \"seconds\"),\n        leftoffset = getSecondsToday(eventstarts) - tablestarts;\n\n    $(eventDOMobj).css(\"width\", eventlength / fulldiff * 100 + \"%\").css(\"left\", leftoffset / fulldiff * 100 + \"%\");\n  };\n\n  $(document).foundation();\n\n  /** Otevírání jednotlivých paralelek */\n\n  $(\".parallel\").click(function (e) {\n    if ($(this).hasClass(\"parallel-extended\")) {\n      // Zavření paralelky po kliknutí na header otevřené paralelky\n      closeParallels();\n    } else {\n      // Otevření paralelky\n      $(\".parallel\").removeClass(\"parallel-extended\").each(function (num, el) {\n        $(el)[0].style = \" \";\n      });\n      $(this).addClass(\"parallel-extended\");\n      $(\"section#timetable\").addClass(\"fade-inactive\");\n\n      // Upravit pozici, pokud by se box otevřel přes pravý kraj viewportu\n      /*if ($(this).offset().left + 300 >= $(window).width()) {\r\n          var left = $(this).offset().left - $(\"section#timetable > .row\").offset().left;\r\n          console.log(left);\r\n          var difference = $(this).offset().left - $(window).width();\r\n          left = left + difference - 20;\r\n          console.log([left, difference ]);\r\n          $(this)[0].style = \"left: \"+ left + \"px\";\r\n      } wrong , přepsat... */\n\n      // Pozice parallel-details boxu\n      var parallelBoxPos = {\n        x: $(this).offset().left - $(\"section#timetable > .row\").offset().left + 2.5,\n        y: $(this).offset().top - $(\"section#timetable > .row\").offset().top + $(this).height()\n      };\n\n      $(\".parallel-details\").hide().slideDown(400).css(\"left\", parallelBoxPos.x + \"px\").css(\"top\", parallelBoxPos.y + \"px\");\n    }\n  });\n\n\n\n  /** Zavření všech paralelek po kliknutí jinam */\n\n  $(\".row.tt-row, section#timetable, div.gap, div.info-line\").click(function (e) {\n    closeParallels();\n  }).children().click(function (e) {\n    return false;\n  });\n\n\n  /** Procházení týdnů */\n\n  $(\"a.prev-week\").click(function () {\n    $(\"section#timetable\").removeClass(\"animate-left\").removeClass(\"animate-right\");\n    setTimeout(function () {\n      $(\"section#timetable\").addClass(\"animate-right\");\n    }, 100);\n    switchWeek(parseInt($(\"section#timetable\").attr(\"data-week\")) - 1);\n  });\n  $(\"a.next-week\").click(function () {\n    $(\"section#timetable\").removeClass(\"animate-left\").removeClass(\"animate-right\");\n    setTimeout(function () {\n      $(\"section#timetable\").addClass(\"animate-left\");\n    }, 100);\n    switchWeek(parseInt($(\"section#timetable\").attr(\"data-week\")) + 1);\n  });\n\n\n\n\n  /** Dočasně zavírat ajax loaderovátko */\n  setTimeout(function () {\n    $(\".info-line .spinner\").fadeOut(500);\n  }, 2000);\n\n\n  /** Dočasné přihl. údaje na sirius */\n  $(\"input#accesstoken\").val($.cookie(\"sirius-accesstoken\"));\n  $(\"input#username\").val($.cookie(\"sirius-username\"));\n\n  $(\"#savein\").click(function () {\n    $.cookie(\"sirius-accesstoken\", $(\"input#accesstoken\").val(), { expires: 14 });\n    $.cookie(\"sirius-username\", $(\"input#username\").val(), { expires: 14 });\n    alert(\"Settings saved. Sup, \" + $(\"input#username\").val() + \" :)\");\n    window.location.reload();\n  });\n\n\n\n  /** Chování rozvržení timetablu */\n\n  $.get(\"https://sirius.fit.cvut.cz/api/v1/people/\" + $.cookie(\"sirius-username\") + \"/events?access_token=\" + $.cookie(\"sirius-accesstoken\") + \"&from=2015-01-12T00:00:00&to=2015-01-19T23:59:59&limit=128\").done(function (d) {\n    if (d.meta.count <= d.meta.limit) {\n      showEvents(d.events);\n    } else console.log(\"Too many data. App is not ready yet for making more requests. Sry :/\");\n  });\n\n});"]}